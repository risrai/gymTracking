<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Gym Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">

  <style>
    :root {
      --primary: #4f46e5;
      --primary-light: #6366f1;
      --secondary: #22c55e;
      --danger: #ef4444;
      --bg: #f1f5f9;
      --card: #ffffff;
      --muted: #64748b;
    }

    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: var(--bg);
    }

    header {
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      color: white;
      padding: 16px;
      text-align: center;
    }

    nav {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-top: 12px;
    }

    nav button {
      padding: 8px 16px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 15px;
      background: rgba(255,255,255,0.25);
      color: white;
      font-weight: 500;
    }

    nav button.active {
      background: white;
      color: var(--primary);
    }

    section {
      display: none;
    }

    section.active {
      display: block;
    }

    .container {
      max-width: 640px;
      margin: auto;
      padding: 16px;
    }

    h3 {
      margin-top: 22px;
      color: #0f172a;
    }

    input, select {
      width: 100%;
      padding: 11px;
      margin-top: 10px;
      font-size: 15px;
      border-radius: 8px;
      border: 1px solid #cbd5f5;
      box-sizing: border-box;
    }

    button.primary {
      width: 100%;
      margin-top: 16px;
      padding: 12px;
      font-size: 16px;
      border-radius: 10px;
      background: var(--primary);
      color: white;
      border: none;
      cursor: pointer;
    }

    .entry-card {
      background: var(--card);
      border-radius: 14px;
      padding: 12px;
      margin-top: 12px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.06);
    }

    .entry-header {
      font-weight: 600;
      margin-bottom: 6px;
    }

    .set-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 4px 0;
      font-size: 14px;
      color: var(--muted);
    }

    .actions {
      display: flex;
      gap: 12px;
    }

    .material-symbols-outlined {
      cursor: pointer;
      font-size: 20px;
    }

    .edit { color: var(--secondary); }
    .delete { color: var(--danger); }

    canvas {
      background: var(--card);
      border-radius: 14px;
      padding: 10px;
      margin-top: 14px;
    }
  </style>
</head>

<body>

<header>
  <h2>üèãÔ∏è Gym Tracker</h2>
  <nav>
    <button id="logTab" class="active" onclick="showPage('log')">Log</button>
    <button id="analysisTab" onclick="showPage('analysis')">Analysis</button>
  </nav>
</header>

<!-- LOG PAGE -->
<section id="log" class="active">
  <div class="container">
    <h3>Add Exercise</h3>

    <input type="date" id="dateInput">
    <input list="activityList" id="activityInput" placeholder="Exercise (Bench Press)">
    <datalist id="activityList"></datalist>

    <input type="number" id="repsInput" placeholder="Reps">
    <input type="number" id="weightInput" placeholder="Weight (kg)">

    <button class="primary" onclick="saveEntry()">Save Entry</button>

    <h3>Entries</h3>
    <div id="entries"></div>
  </div>
</section>

<!-- ANALYSIS PAGE -->
<section id="analysis">
  <div class="container">
    <h3>Progress (Max Weight)</h3>
    <select id="analysisActivity" onchange="renderChart()"></select>
    <canvas id="chart" height="220"></canvas>

    <h3>Logs by Date</h3>
    <input type="date" id="analysisDate" onchange="renderDateLogs()">
    <div id="dateLogs"></div>
  </div>
</section>

<script>
  let data = JSON.parse(localStorage.getItem("gymData") || "[]");
  let editIndex = null;
  let chart = null;

  const today = new Date().toISOString().split("T")[0];
  dateInput.value = today;
  analysisDate.value = today;

  function showPage(id) {
    document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
    document.getElementById(id).classList.add("active");

    logTab.classList.toggle("active", id === "log");
    analysisTab.classList.toggle("active", id === "analysis");

    refreshUI();
  }

  function saveEntry() {
    const entry = {
      date: dateInput.value,
      activity: activityInput.value.trim(),
      reps: Number(repsInput.value),
      weight: Number(weightInput.value)
    };

    if (!entry.activity || !entry.reps || !entry.weight) return;

    if (editIndex !== null) {
      data[editIndex] = entry;
      editIndex = null;
    } else {
      data.push(entry);
    }

    localStorage.setItem("gymData", JSON.stringify(data));
    repsInput.value = "";
    weightInput.value = "";
    activityInput.value = "";
    refreshUI();
  }

  function groupByActivity(entries) {
    return entries.reduce((acc, e, i) => {
      acc[e.activity] = acc[e.activity] || [];
      acc[e.activity].push({ ...e, index: i });
      return acc;
    }, {});
  }

  function renderEntries() {
    entries.innerHTML = "";
    const grouped = groupByActivity(data);

    for (const activity in grouped) {
      const card = document.createElement("div");
      card.className = "entry-card";
      card.innerHTML = `<div class="entry-header">${activity}</div>`;

      grouped[activity].forEach(set => {
        const row = document.createElement("div");
        row.className = "set-row";
        row.innerHTML = `
          <span>${set.reps} reps √ó ${set.weight} kg (${set.date})</span>
          <div class="actions">
            <span class="material-symbols-outlined edit" onclick="editEntry(${set.index})">edit</span>
            <span class="material-symbols-outlined delete" onclick="deleteEntry(${set.index})">delete</span>
          </div>
        `;
        card.appendChild(row);
      });

      entries.appendChild(card);
    }
  }

  function renderDateLogs() {
    dateLogs.innerHTML = "";
    const filtered = data.filter(d => d.date === analysisDate.value);
    const grouped = groupByActivity(filtered);

    for (const activity in grouped) {
      const card = document.createElement("div");
      card.className = "entry-card";
      card.innerHTML = `<div class="entry-header">${activity}</div>`;

      grouped[activity].forEach(set => {
        const row = document.createElement("div");
        row.className = "set-row";
        row.innerHTML = `
          <span>${set.reps} reps √ó ${set.weight} kg</span>
          <div class="actions">
            <span class="material-symbols-outlined edit" onclick="editEntry(${set.index})">edit</span>
            <span class="material-symbols-outlined delete" onclick="deleteEntry(${set.index})">delete</span>
          </div>
        `;
        card.appendChild(row);
      });

      dateLogs.appendChild(card);
    }
  }

  function renderActivityLists() {
    const unique = [...new Set(data.map(d => d.activity))];
    activityList.innerHTML = unique.map(a => `<option value="${a}">`).join("");
    analysisActivity.innerHTML =
      `<option value="">Select exercise</option>` +
      unique.map(a => `<option>${a}</option>`).join("");
  }

  function renderChart() {
    const activity = analysisActivity.value;
    if (!activity) return;

    const maxByDate = {};
    data.filter(d => d.activity === activity).forEach(d => {
      maxByDate[d.date] = Math.max(maxByDate[d.date] || 0, d.weight);
    });

    const dates = Object.keys(maxByDate).sort((a,b) => new Date(a)-new Date(b));
    const values = dates.map(d => maxByDate[d]);

    if (chart) chart.destroy();

    chart = new Chart(document.getElementById("chart"), {
      type: "line",
      data: {
        labels: dates,
        datasets: [{
          data: values,
          borderColor: "#4f46e5",
          backgroundColor: "#6366f1",
          tension: 0.35
        }]
      },
      options: { plugins: { legend: { display: false } } }
    });
  }

  function editEntry(i) {
    const e = data[i];
    dateInput.value = e.date;
    activityInput.value = e.activity;
    repsInput.value = e.reps;
    weightInput.value = e.weight;
    editIndex = i;
    showPage("log");
  }

  function deleteEntry(i) {
    if (!confirm("Delete this set?")) return;
    data.splice(i, 1);
    localStorage.setItem("gymData", JSON.stringify(data));
    refreshUI();
  }

  function refreshUI() {
    renderEntries();
    renderActivityLists();
    renderChart();
    renderDateLogs();
  }

  refreshUI();
</script>

</body>
</html>
