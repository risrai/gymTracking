<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Gym Activity Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Google Material Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">

  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      background: #f4f6f8;
    }

    header {
      background: #111;
      color: #fff;
      padding: 14px;
      text-align: center;
    }

    nav {
      display: flex;
      justify-content: center;
      gap: 24px;
      margin-top: 10px;
    }

    nav button {
      background: none;
      border: none;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
    }

    section {
      display: none;
      padding: 16px;
    }

    section.active {
      display: block;
    }

    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      font-size: 16px;
    }

    button.primary {
      width: 100%;
      margin-top: 14px;
      padding: 12px;
      font-size: 16px;
      background: #111;
      color: #fff;
      border: none;
      cursor: pointer;
    }

    .entry-card {
      background: #fff;
      border-radius: 8px;
      margin-top: 10px;
      padding: 12px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.08);
    }

    .entry-card.compact {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .entry-main {
      display: flex;
      align-items: center;
      gap: 10px;
      overflow: hidden;
      flex-wrap: nowrap;
    }

    .entry-main span {
      white-space: nowrap;
      font-size: 14px;
    }

    .entry-main .activity {
      font-weight: 600;
      max-width: 120px;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .entry-main .date {
      color: #666;
      font-size: 12px;
    }

    .actions {
      display: flex;
      gap: 14px;
      flex-shrink: 0;
    }

    .material-symbols-outlined {
      cursor: pointer;
      font-size: 22px;
    }

    .edit {
      color: #1976d2;
    }

    .delete {
      color: #d32f2f;
    }

    canvas {
      background: #fff;
      border-radius: 8px;
      padding: 10px;
      margin-top: 12px;
    }
  </style>
</head>

<body>

<header>
  <h2>üèãÔ∏è Gym Tracker</h2>
  <nav>
    <button onclick="showPage('log')">Log</button>
    <button onclick="showPage('analysis')">Analysis</button>
  </nav>
</header>

<!-- LOG PAGE -->
<section id="log" class="active">
  <h3>Add Activity</h3>

  <input type="date" id="dateInput">
  <input list="activityList" id="activityInput" placeholder="Activity (e.g. Chest Press)">
  <datalist id="activityList"></datalist>

  <select id="metricInput">
    <option value="Weight">Max Weight (kg)</option>
    <option value="Duration">Duration (min)</option>
  </select>

  <input type="number" id="valueInput" placeholder="Value">

  <button class="primary" onclick="saveEntry()">Save Entry</button>

  <h3>Entries</h3>
  <div id="entries"></div>
</section>

<!-- ANALYSIS PAGE -->
<section id="analysis">
  <h3>Activity-wise Trend</h3>
  <select id="analysisActivity" onchange="renderChart()"></select>
  <canvas id="chart" height="220"></canvas>

  <h3>Logs by Date</h3>
  <input type="date" id="analysisDate" onchange="renderDateLogs()">
  <div id="dateLogs"></div>
</section>

<script>
  let data = JSON.parse(localStorage.getItem("gymData") || "[]");
  let editIndex = null;
  let chart = null;

  const today = new Date().toISOString().split("T")[0];
  dateInput.value = today;
  analysisDate.value = today;

  function showPage(id) {
    document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    refreshUI();
  }

  function saveEntry() {
    const activity = activityInput.value.trim();
    const value = Number(valueInput.value);

    if (!activity || !value) return;

    const entry = {
      date: dateInput.value,
      activity,
      metric: metricInput.value,
      value
    };

    if (editIndex !== null) {
      data[editIndex] = entry;
      editIndex = null;
    } else {
      data.push(entry);
    }

    localStorage.setItem("gymData", JSON.stringify(data));
    activityInput.value = "";
    valueInput.value = "";
    refreshUI();
  }

  function refreshUI() {
    renderEntries();
    renderActivityLists();
    renderChart();
    renderDateLogs();
  }

  function renderEntries() {
    entries.innerHTML = "";
    data.forEach((e, i) => {
      const div = document.createElement("div");
      div.className = "entry-card compact";
      div.innerHTML = `
        <div class="entry-main">
          <span class="activity">${e.activity}</span>
          <span>${e.value} ${e.metric === "Weight" ? "kg" : "min"}</span>
          <span class="date">${e.date}</span>
        </div>
        <div class="actions">
          <span class="material-symbols-outlined edit" onclick="editEntry(${i})">edit</span>
          <span class="material-symbols-outlined delete" onclick="deleteEntry(${i})">delete</span>
        </div>
      `;
      entries.appendChild(div);
    });
  }

  function editEntry(i) {
    const e = data[i];
    dateInput.value = e.date;
    activityInput.value = e.activity;
    metricInput.value = e.metric;
    valueInput.value = e.value;
    editIndex = i;
    showPage("log");
  }

  function deleteEntry(i) {
    if (!confirm("Delete this entry?")) return;
    data.splice(i, 1);
    localStorage.setItem("gymData", JSON.stringify(data));
    refreshUI();
  }

  function renderActivityLists() {
    const unique = [...new Set(data.map(d => d.activity))];
    activityList.innerHTML = unique.map(a => `<option value="${a}">`).join("");
    analysisActivity.innerHTML =
      `<option value="">Select activity</option>` +
      unique.map(a => `<option>${a}</option>`).join("");
  }

  function renderChart() {
    const activity = analysisActivity.value;
    if (!activity) return;

    const filtered = data.filter(d => d.activity === activity);
    const labels = filtered.map(d => d.date);
    const values = filtered.map(d => d.value);

    if (chart) chart.destroy();

    chart = new Chart(document.getElementById("chart"), {
      type: "line",
      data: {
        labels,
        datasets: [{
          label: activity,
          data: values,
          borderWidth: 2,
          fill: false
        }]
      }
    });
  }

  function renderDateLogs() {
    const date = analysisDate.value;
    dateLogs.innerHTML = "";

    data.forEach((e, i) => {
      if (e.date !== date) return;

      const div = document.createElement("div");
      div.className = "entry-card compact";
      div.innerHTML = `
        <div class="entry-main">
          <span class="activity">${e.activity}</span>
          <span>${e.value} ${e.metric === "Weight" ? "kg" : "min"}</span>
        </div>
        <div class="actions">
          <span class="material-symbols-outlined edit" onclick="editEntry(${i})">edit</span>
          <span class="material-symbols-outlined delete" onclick="deleteEntry(${i})">delete</span>
        </div>
      `;
      dateLogs.appendChild(div);
    });
  }

  refreshUI();
</script>

</body>
</html>
